# MERI 项目快速入门指南

## 🎯 5 分钟快速理解

### 项目是做什么的？

**输入**：PDF 文档 + JSON Schema（定义要提取什么）
**输出**：从 PDF 中提取的结构化 JSON 数据

### 核心流程（3 步）

```
PDF → HTML → Chunks → JSON
```

1. **PDF → HTML**：用 Docling 解析 PDF，转换成 HTML（包含文本和图片）
2. **HTML → Chunks**：把大文档切分成小块（因为大模型有长度限制）
3. **Chunks → JSON**：用大模型从每个小块中提取信息，合并成最终结果

---

## 📖 详细理解（推荐阅读顺序）

### 第 1 步：看整体架构

阅读 `项目详细解读.md` 的以下部分：
- [项目概述](#项目概述)
- [整体架构](#整体架构)
- [核心流程](#核心流程)

**目标**：理解项目是做什么的，整体流程是什么

### 第 2 步：理解关键模块

阅读 `项目详细解读.md` 的以下部分：
- [模块详解](#模块详解)

**重点关注**：
1. **MERI 主类**：入口，用户直接使用
2. **格式处理器**：处理 HTML，切分成 chunks
3. **提取器**：协调提取过程
4. **迭代填充器**：核心逻辑，调用大模型

**目标**：理解每个模块的作用

### 第 3 步：看代码执行流程

阅读 `项目详细解读.md` 的以下部分：
- [代码逐行解析](#代码逐行解析)

**目标**：理解代码是如何一步步执行的

### 第 4 步：理解数据流转

阅读 `项目详细解读.md` 的以下部分：
- [数据流转](#数据流转)

**目标**：理解数据格式是如何变化的

### 第 5 步：学习如何修改

阅读 `项目详细解读.md` 的以下部分：
- [如何修改项目](#如何修改项目)

**目标**：知道如何根据自己的需求修改项目

---

## 🔍 深入理解技巧

### 技巧 1：跟踪一个完整的执行流程

1. 运行 `test_meri.py`
2. 在关键位置添加 `print()` 语句，看数据变化
3. 理解每一步的数据格式

**示例**：在 `format_handler.py` 的 `chunk()` 方法中添加
```python
def chunk(self, character_threshold=1000, overlap=2):
    html_parts = self.split_add_type()
    print(f"切分后的部分数量: {len(html_parts)}")
    print(f"前 3 个部分: {html_parts[:3]}")
    # ... 其余代码
```

### 技巧 2：理解关键数据结构

**Chunk 的结构**：
```python
# 一个 chunk 是：
[
    ('text', '<div>文本内容</div>'),
    ('image', '<div class="image_wrapper"><img src="data:image/..."></div>'),
    ('text', '<div>更多文本</div>'),
]
```

**消息格式**（发送给大模型）：
```python
[
    {"type": "text", "text": "文本内容"},
    {"type": "image_url", "image_url": {"url": "data:image/..."}},
    {"type": "text", "text": "更多文本"},
]
```

### 技巧 3：理解函数调用

**函数调用的作用**：
- 把 JSON Schema 定义为一个"函数"的参数
- 要求大模型"调用"这个函数，传入符合 Schema 的 JSON 数据
- 从函数调用的参数中提取 JSON

**如果不支持函数调用**：
- 需要修改 `iterative_json_completion.py` 的 `process_completion()` 方法
- 改为直接解析大模型输出的 JSON 文本

---

## 🛠️ 实践建议

### 阶段 1：理解基础（1-2 天）

1. ✅ 阅读 `项目详细解读.md`
2. ✅ 运行 `test_meri.py`，看效果
3. ✅ 在关键位置添加 `print()`，看数据变化
4. ✅ 修改 Prompt，看效果变化

### 阶段 2：理解细节（2-3 天）

1. ✅ 理解每个模块的作用
2. ✅ 理解数据流转过程
3. ✅ 理解函数调用的机制
4. ✅ 理解三种提取策略的区别

### 阶段 3：开始修改（根据需求）

1. ✅ 修改 Prompt（最简单）
2. ✅ 修改 Chunk 大小
3. ✅ 修改提取策略
4. ✅ 适配不支持函数调用的模型

---

## ❓ 常见问题

### Q1: 为什么要把 PDF 转换成 HTML？

**A**: 
- HTML 格式可以同时包含文本和图片（base64）
- 大模型可以同时处理文本和图片（多模态）
- HTML 保留了文档的结构信息（位置、页面等）

### Q2: 为什么需要切分成 chunks？

**A**:
- 大模型有输入长度限制（token 限制）
- 大文档一次性处理可能丢失信息
- 切分后可以逐个处理，更准确

### Q3: 什么是"函数调用"？

**A**:
- 一种让大模型以结构化方式输出数据的方法
- 把 JSON Schema 定义为"函数"的参数
- 大模型必须按照 Schema 输出，确保格式正确

详见 `函数调用说明.md`

### Q4: 三种提取策略有什么区别？

**A**:
- **ONE2ONE**：每个参数只提取一次
- **ONE2MANY**：每个参数可以多次提取
- **SELFSUPERVISED**：模型可以看到已提取的数据，可以自己判断和修正

### Q5: 如何修改项目？

**A**:
详见 `项目详细解读.md` 的 [如何修改项目](#如何修改项目) 部分

---

## 📚 相关文档

- **`项目详细解读.md`**：完整的项目解读（**必读**）
- **`函数调用说明.md`**：函数调用的详细说明
- **`使用免费模型指南.md`**：如何使用免费大模型
- **`README.md`**：项目官方文档

---

## 🎓 学习路径总结

```
第 1 天：理解整体架构
  ↓
第 2 天：理解关键模块
  ↓
第 3 天：理解代码执行流程
  ↓
第 4 天：理解数据流转
  ↓
第 5 天：开始修改项目
```

**记住**：不要急于修改代码，先理解清楚再动手！

---

**祝您学习顺利！**




