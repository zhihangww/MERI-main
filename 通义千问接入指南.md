# é€šä¹‰åƒé—®ï¼ˆQwenï¼‰æ¥å…¥æŒ‡å—

## âœ… ç¡®è®¤ï¼šLiteLLM å®Œå…¨æ”¯æŒé€šä¹‰åƒé—®

**å¥½æ¶ˆæ¯ï¼** LiteLLM **å®Œå…¨æ”¯æŒ**æ¥å…¥é˜¿é‡Œå·´å·´çš„é€šä¹‰åƒé—®ï¼ˆQwenï¼‰æ¨¡å‹ï¼ŒåŒ…æ‹¬ï¼š
- âœ… é€šä¹‰åƒé—®æ–‡æœ¬æ¨¡å‹ï¼ˆQwenï¼‰
- âœ… é€šä¹‰åƒé—®å¤šæ¨¡æ€æ¨¡å‹ï¼ˆQwen-VLï¼‰
- âœ… é€šè¿‡ DashScope API è°ƒç”¨

## ğŸ”§ æ¥å…¥æ­¥éª¤

### æ­¥éª¤1ï¼šè·å– DashScope API å¯†é’¥

1. è®¿é—® [é˜¿é‡Œäº‘ DashScope æ§åˆ¶å°](https://dashscope.console.aliyun.com/)
2. æ³¨å†Œ/ç™»å½•è´¦å·
3. åˆ›å»º API å¯†é’¥ï¼ˆAPI Keyï¼‰
4. å¤åˆ¶ API å¯†é’¥

### æ­¥éª¤2ï¼šé…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```bash
# é€šä¹‰åƒé—® DashScope API å¯†é’¥
DASHSCOPE_API_KEY=sk-your-api-key-here
```

### æ­¥éª¤3ï¼šåœ¨ä»£ç ä¸­ä½¿ç”¨

**å®Œå…¨ä¸éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç ï¼** åªéœ€è¦åœ¨åˆ›å»º MERI å®ä¾‹æ—¶æŒ‡å®šæ¨¡å‹åç§°ï¼š

```python
from meri import MERI
import json

# ä½¿ç”¨é€šä¹‰åƒé—®å¤šæ¨¡æ€æ¨¡å‹ï¼ˆæ¨èï¼Œæ”¯æŒå›¾ç‰‡ï¼‰
meri = MERI(
    pdf_path='chinese_document.pdf',
    model='qwen/qwen-vl-max',  # é€šä¹‰åƒé—®VLå¤šæ¨¡æ€æ¨¡å‹
    model_temp=0.0,
    do_ocr=False
)

# å…¶ä»–ä»£ç å®Œå…¨ä¸å˜
schema = json.load(open('schema.json', 'r', encoding='utf-8'))
result = meri.run(json.dumps(schema, ensure_ascii=False))
```

## ğŸ“‹ æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨

### å¤šæ¨¡æ€æ¨¡å‹ï¼ˆæ¨èç”¨äº MERIï¼‰

| æ¨¡å‹åç§° | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|
| `qwen/qwen-vl-max` | é€šä¹‰åƒé—®VLæœ€å¤§ç‰ˆæœ¬ | æœ€ä½³æ•ˆæœï¼Œæ”¯æŒå›¾ç‰‡ |
| `qwen/qwen-vl-plus` | é€šä¹‰åƒé—®VLå¢å¼ºç‰ˆ | å¹³è¡¡æ•ˆæœå’Œæˆæœ¬ |
| `qwen-vl-max` | ç®€åŒ–åç§°ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬æ”¯æŒï¼‰ | åŒä¸Š |

### æ–‡æœ¬æ¨¡å‹ï¼ˆä¸æ”¯æŒå›¾ç‰‡ï¼Œä¸æ¨èç”¨äº MERIï¼‰

| æ¨¡å‹åç§° | è¯´æ˜ | æ³¨æ„ |
|---------|------|------|
| `qwen-plus` | é€šä¹‰åƒé—®å¢å¼ºç‰ˆ | âŒ ä¸æ”¯æŒå›¾ç‰‡ |
| `qwen-turbo` | é€šä¹‰åƒé—®å¿«é€Ÿç‰ˆ | âŒ ä¸æ”¯æŒå›¾ç‰‡ |
| `qwen-max` | é€šä¹‰åƒé—®æœ€å¤§ç‰ˆ | âŒ ä¸æ”¯æŒå›¾ç‰‡ |

**âš ï¸ é‡è¦ï¼šMERI éœ€è¦å¤„ç†å›¾ç‰‡ï¼ˆPDFä¸­çš„è¡¨æ ¼ã€å›¾è¡¨ï¼‰ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨å¤šæ¨¡æ€æ¨¡å‹ï¼ˆVLç‰ˆæœ¬ï¼‰ï¼**

## ğŸ¯ å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šåŸºæœ¬ä½¿ç”¨

```python
from meri import MERI
import json
import os

# é…ç½®è·¯å¾„
pdf_path = 'chinese_document.pdf'
schema_path = 'chinese_schema.json'

# åŠ è½½Schema
with open(schema_path, 'r', encoding='utf-8') as f:
    schema = json.load(f)

# åˆ›å»ºMERIå®ä¾‹ï¼Œä½¿ç”¨é€šä¹‰åƒé—®VL
meri = MERI(
    pdf_path=pdf_path,
    model='qwen/qwen-vl-max',  # é€šä¹‰åƒé—®å¤šæ¨¡æ€æ¨¡å‹
    model_temp=0.0,
    do_ocr=False
)

# è½¬æ¢ä¸ºä¸­é—´æ ¼å¼
meri.to_intermediate()

# æå–å‚æ•°
result = meri.run(json.dumps(schema, ensure_ascii=False))

# ä¿å­˜ç»“æœ
with open('output.json', 'w', encoding='utf-8') as f:
    json.dump(result, f, indent=2, ensure_ascii=False)
```

### ç¤ºä¾‹2ï¼šåœ¨æµ‹è¯•è„šæœ¬ä¸­ä½¿ç”¨

```python
# test_qwen.py
from meri import MERI
import json

def main():
    pdf_path = 'data/demo_data/chinese_document.pdf'
    schema_path = 'data/demo_data/chinese_schema.json'
    
    # ä½¿ç”¨é€šä¹‰åƒé—®
    meri = MERI(
        pdf_path=pdf_path,
        model='qwen/qwen-vl-max',  # åˆ‡æ¢åˆ°é€šä¹‰åƒé—®
        model_temp=0.0
    )
    
    with open(schema_path, 'r', encoding='utf-8') as f:
        schema = json.load(f)
    
    meri.to_intermediate()
    result = meri.run(json.dumps(schema, ensure_ascii=False))
    
    print(json.dumps(result, indent=2, ensure_ascii=False))

if __name__ == "__main__":
    main()
```

## ğŸ” æ¨¡å‹åç§°æ ¼å¼è¯´æ˜

LiteLLM ä½¿ç”¨ä»¥ä¸‹æ ¼å¼è°ƒç”¨é€šä¹‰åƒé—®ï¼š

### æ ‡å‡†æ ¼å¼
```
qwen/qwen-vl-max
qwen/qwen-vl-plus
```

### ç®€åŒ–æ ¼å¼ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬æ”¯æŒï¼‰
```
qwen-vl-max
qwen-vl-plus
```

**å»ºè®®ä½¿ç”¨æ ‡å‡†æ ¼å¼ `qwen/qwen-vl-max`ï¼Œå…¼å®¹æ€§æœ€å¥½ã€‚**

## âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®

### .env æ–‡ä»¶ç¤ºä¾‹

```bash
# OpenAIï¼ˆå¦‚æœè¿˜éœ€è¦ï¼‰
OPENAI_API_KEY=sk-...

# é€šä¹‰åƒé—® DashScope
DASHSCOPE_API_KEY=sk-your-dashscope-api-key

# å…¶ä»–æ¨¡å‹ï¼ˆå¯é€‰ï¼‰
# ZHIPU_API_KEY=your-key  # æ™ºè°±GLM
# BAIDU_API_KEY=your-key  # ç™¾åº¦æ–‡å¿ƒ
```

### éªŒè¯é…ç½®

```python
import os
from dotenv import load_dotenv

load_dotenv()

# æ£€æŸ¥APIå¯†é’¥æ˜¯å¦é…ç½®
api_key = os.getenv('DASHSCOPE_API_KEY')
if api_key:
    print("âœ… DashScope API å¯†é’¥å·²é…ç½®")
else:
    print("âŒ DashScope API å¯†é’¥æœªé…ç½®")
```

## ğŸ§ª æµ‹è¯•è¿æ¥

### ç®€å•æµ‹è¯•è„šæœ¬

```python
from litellm import completion
import os
from dotenv import load_dotenv

load_dotenv()

# æµ‹è¯•é€šä¹‰åƒé—®è¿æ¥
try:
    response = completion(
        model="qwen/qwen-vl-max",
        messages=[
            {"role": "user", "content": "ä½ å¥½ï¼Œè¯·ç”¨ä¸­æ–‡å›ç­”ï¼š1+1ç­‰äºå¤šå°‘ï¼Ÿ"}
        ],
        api_key=os.getenv('DASHSCOPE_API_KEY')
    )
    print("âœ… è¿æ¥æˆåŠŸï¼")
    print("å›å¤:", response.choices[0].message.content)
except Exception as e:
    print("âŒ è¿æ¥å¤±è´¥:", e)
    print("ğŸ’¡ è¯·æ£€æŸ¥ï¼š")
    print("   1. DASHSCOPE_API_KEY æ˜¯å¦æ­£ç¡®é…ç½®")
    print("   2. API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ")
    print("   3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸")
```

## ğŸ’° æˆæœ¬è¯´æ˜

é€šä¹‰åƒé—®çš„å®šä»·ï¼ˆå‚è€ƒï¼Œå…·ä½“ä»¥å®˜æ–¹ä¸ºå‡†ï¼‰ï¼š
- `qwen/qwen-vl-max`: æŒ‰ token è®¡è´¹ï¼Œé€šå¸¸æ¯” GPT-4o ä¾¿å®œ
- `qwen/qwen-vl-plus`: æ›´ç»æµçš„é€‰æ‹©

**å»ºè®®ï¼š**
- å…ˆç”¨ `qwen/qwen-vl-plus` æµ‹è¯•æ•ˆæœ
- å¦‚æœæ•ˆæœä¸å¤Ÿå¥½ï¼Œå†å‡çº§åˆ° `qwen/qwen-vl-max`

## âš ï¸ å¸¸è§é—®é¢˜

### 1. æ¨¡å‹åç§°é”™è¯¯

**é”™è¯¯ï¼š**
```python
model='qwen-vl-max'  # å¯èƒ½ä¸å·¥ä½œ
```

**æ­£ç¡®ï¼š**
```python
model='qwen/qwen-vl-max'  # æ ‡å‡†æ ¼å¼
```

### 2. API å¯†é’¥æœªé…ç½®

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Exception: No API key provided
```

**è§£å†³æ–¹æ³•ï¼š**
- æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­æ˜¯å¦æœ‰ `DASHSCOPE_API_KEY`
- ç¡®ä¿ API å¯†é’¥æ ¼å¼æ­£ç¡®ï¼ˆé€šå¸¸ä»¥ `sk-` å¼€å¤´ï¼‰

### 3. ä½¿ç”¨äº†ä¸æ”¯æŒå›¾ç‰‡çš„æ¨¡å‹

**é”™è¯¯ï¼š**
```python
model='qwen-plus'  # ä¸æ”¯æŒå›¾ç‰‡ï¼ŒMERIæ— æ³•ä½¿ç”¨
```

**æ­£ç¡®ï¼š**
```python
model='qwen/qwen-vl-max'  # æ”¯æŒå›¾ç‰‡
```

### 4. ç½‘ç»œè¿æ¥é—®é¢˜

å¦‚æœé‡åˆ°è¿æ¥è¶…æ—¶ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤ DashScope API æœåŠ¡æ˜¯å¦æ­£å¸¸
- è€ƒè™‘ä½¿ç”¨ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰

## ğŸ“Š å¯¹æ¯”å…¶ä»–æ¨¡å‹

| ç‰¹æ€§ | gpt-4o-mini | qwen/qwen-vl-max | gpt-4o |
|------|-------------|------------------|--------|
| ä¸­æ–‡æ”¯æŒ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| å¤šæ¨¡æ€ | âœ… | âœ… | âœ… |
| æˆæœ¬ | ä½ | ä¸­ | é«˜ |
| å›½å†…è®¿é—® | æ…¢ | å¿« | æ…¢ |
| æ¨èåº¦ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šç›´æ¥ä½¿ç”¨é€šä¹‰åƒé—®VLï¼ˆæ¨èï¼‰

```python
meri = MERI(
    pdf_path='chinese_document.pdf',
    model='qwen/qwen-vl-max',
    model_temp=0.0
)
```

**ä¼˜ç‚¹ï¼š**
- âœ… å¯¹ä¸­æ–‡æ”¯æŒæœ€å¥½
- âœ… å›½å†…è®¿é—®å¿«
- âœ… æ€§ä»·æ¯”é«˜
- âœ… å¤šæ¨¡æ€æ”¯æŒ

### æ–¹æ¡ˆ2ï¼šå…ˆè¯• Plus ç‰ˆæœ¬ï¼ˆç»æµï¼‰

```python
meri = MERI(
    pdf_path='chinese_document.pdf',
    model='qwen/qwen-vl-plus',  # æ›´ä¾¿å®œ
    model_temp=0.0
)
```

å¦‚æœæ•ˆæœä¸å¤Ÿå¥½ï¼Œå†å‡çº§åˆ° `max` ç‰ˆæœ¬ã€‚

## ğŸ“ å®Œæ•´é…ç½®æ£€æŸ¥æ¸…å•

- [ ] å·²æ³¨å†Œé˜¿é‡Œäº‘ DashScope è´¦å·
- [ ] å·²åˆ›å»ºå¹¶å¤åˆ¶ API å¯†é’¥
- [ ] åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ  `DASHSCOPE_API_KEY`
- [ ] ä½¿ç”¨å¤šæ¨¡æ€æ¨¡å‹ï¼ˆVLç‰ˆæœ¬ï¼‰
- [ ] æ¨¡å‹åç§°æ ¼å¼æ­£ç¡®ï¼ˆ`qwen/qwen-vl-max`ï¼‰
- [ ] æµ‹è¯•è¿æ¥æˆåŠŸ

## ğŸ”— ç›¸å…³èµ„æº

- [DashScope æ§åˆ¶å°](https://dashscope.console.aliyun.com/)
- [é€šä¹‰åƒé—®æ–‡æ¡£](https://help.aliyun.com/zh/model-studio/)
- [LiteLLM æ–‡æ¡£](https://docs.litellm.ai/)
- [LiteLLM æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨](https://docs.litellm.ai/docs/providers)

## ğŸ“Œ æ€»ç»“

- âœ… **LiteLLM å®Œå…¨æ”¯æŒé€šä¹‰åƒé—®**
- âœ… **åªéœ€è¦ä¿®æ”¹æ¨¡å‹åç§°ï¼Œä¸éœ€è¦æ”¹ä»£ç **
- âœ… **å¿…é¡»ä½¿ç”¨å¤šæ¨¡æ€æ¨¡å‹ï¼ˆVLç‰ˆæœ¬ï¼‰**
- âœ… **é…ç½®ç®€å•ï¼šæ·»åŠ  API å¯†é’¥å³å¯**
- ğŸ’¡ **æ¨èä½¿ç”¨ `qwen/qwen-vl-max` è·å¾—æœ€ä½³ä¸­æ–‡å¤„ç†æ•ˆæœ**


